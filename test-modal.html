<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Click Test</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
      padding: 20px;
    }
    .test-results {
      margin: 20px 0;
      padding: 15px;
      background: #f0f0f0;
      border-radius: 8px;
    }
    .test-results h2 {
      margin-bottom: 10px;
    }
    .log-item {
      padding: 5px;
      margin: 2px 0;
      background: white;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }
    button {
      padding: 10px 20px;
      background: #3B82F6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #2563EB;
    }
  </style>
</head>
<body>
  <h1>Modal Click Handler Test</h1>
  <p>This test verifies that click handlers work correctly in React Portals</p>

  <div id="root"></div>
  <div class="test-results">
    <h2>Event Log:</h2>
    <div id="event-log"></div>
  </div>

  <script type="text/babel">
    const { useState } = React;
    const { createPortal } = ReactDOM;

    function logEvent(message) {
      const log = document.getElementById('event-log');
      const item = document.createElement('div');
      item.className = 'log-item';
      item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(item);
      log.scrollTop = log.scrollHeight;
    }

    function TestModal({ isOpen, onClose }) {
      if (!isOpen) return null;

      logEvent('Modal render - isOpen=' + isOpen);

      const handleBackdropClick = (e) => {
        logEvent('Backdrop clicked');
        onClose();
      };

      const handleContentClick = (e) => {
        logEvent('Content clicked - stopPropagation called');
        e.stopPropagation();
      };

      const handleCloseButton = (e) => {
        logEvent('Close button clicked');
        onClose();
      };

      return createPortal(
        <div
          style={{
            position: 'fixed',
            inset: 0,
            backgroundColor: 'rgba(0, 0, 0, 0.5)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 70000
          }}
          onClick={handleBackdropClick}
        >
          <div
            style={{
              backgroundColor: 'white',
              borderRadius: '12px',
              width: '400px',
              padding: '24px',
              boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)',
              position: 'relative',
              zIndex: 70001
            }}
            onClick={handleContentClick}
          >
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
              <h3 style={{ fontSize: '18px', fontWeight: 600 }}>Test Modal</h3>
              <button
                onClick={handleCloseButton}
                style={{
                  padding: '4px',
                  background: '#F3F4F6',
                  color: '#6B7280',
                  borderRadius: '4px'
                }}
              >
                âœ•
              </button>
            </div>
            <p style={{ marginBottom: '16px' }}>
              Click the X button, Close button below, or click outside this modal to test the click handlers.
            </p>
            <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
              <button onClick={handleCloseButton}>
                Close
              </button>
            </div>
          </div>
        </div>,
        document.body
      );
    }

    function App() {
      const [isModalOpen, setIsModalOpen] = useState(false);

      const openModal = () => {
        logEvent('Opening modal');
        setIsModalOpen(true);
      };

      const closeModal = () => {
        logEvent('Closing modal (onClose called)');
        setIsModalOpen(false);
      };

      return (
        <div>
          <button onClick={openModal}>
            Open Test Modal
          </button>
          <button onClick={() => {
            document.getElementById('event-log').innerHTML = '';
            logEvent('Log cleared');
          }}>
            Clear Log
          </button>

          <TestModal isOpen={isModalOpen} onClose={closeModal} />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    logEvent('Test page loaded');
  </script>
</body>
</html>
