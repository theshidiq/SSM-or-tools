<!DOCTYPE html>
<html>
<head>
  <title>Delete Fix Test</title>
</head>
<body>
  <h1>Delete Group Fix Test</h1>
  <button onclick="testDelete()">Test Delete Detection</button>
  <pre id="output"></pre>

  <script>
    function log(msg) {
      document.getElementById('output').textContent += msg + '\n';
    }

    function testDelete() {
      document.getElementById('output').textContent = '';

      // Simulate the exact flow from the fix
      const settings = {
        staffGroups: [
          { id: '1', name: 'Test Group', members: [] },
          { id: '2', name: 'New Group', members: ['staff1'] },
          { id: '3', name: 'New Group 1', members: [] }
        ]
      };

      log('BEFORE DELETE:');
      log(`  settings.staffGroups.length: ${settings.staffGroups.length}`);
      log('');

      // Simulate delete group with id '1' (Test Group)
      const groupId = '1';
      const staffGroups = settings.staffGroups;
      const updatedGroups = staffGroups.filter(g => g.id !== groupId);

      const updatedSettings = {
        ...settings,
        staffGroups: [...updatedGroups]
      };

      log('AFTER DELETE:');
      log(`  updatedSettings.staffGroups.length: ${updatedSettings.staffGroups.length}`);
      log('');

      // Simulate change detection (from useSettingsData.js)
      const oldSettings = settings;
      const newSettings = updatedSettings;

      log('CHANGE DETECTION:');
      log(`  oldSettings.staffGroups.length: ${oldSettings.staffGroups.length}`);
      log(`  newSettings.staffGroups.length: ${newSettings.staffGroups.length}`);
      log('');

      if (JSON.stringify(oldSettings.staffGroups) !== JSON.stringify(newSettings.staffGroups)) {
        log('✅ Staff groups changed - detecting changes...');

        const oldGroups = oldSettings.staffGroups || [];
        const newGroups = newSettings.staffGroups || [];
        const oldGroupIds = new Set(oldGroups.map(g => g.id));
        const newGroupIds = new Set(newGroups.map(g => g.id));

        log(`  oldGroupIds: [${Array.from(oldGroupIds).join(', ')}]`);
        log(`  newGroupIds: [${Array.from(newGroupIds).join(', ')}]`);

        // Detect DELETED groups
        const deletedGroupIds = [...oldGroupIds].filter(id => !newGroupIds.has(id));

        if (deletedGroupIds.length > 0) {
          log('');
          log(`✅ ${deletedGroupIds.length} group(s) deleted:`);
          deletedGroupIds.forEach(id => {
            const deletedGroup = oldGroups.find(g => g.id === id);
            log(`  - Deleting group "${deletedGroup?.name}" (${id})`);
            log(`  - Would call: wsDeleteStaffGroup("${id}")`);
          });
        } else {
          log('');
          log('❌ No deleted groups detected!');
        }
      } else {
        log('❌ No changes detected!');
      }
    }
  </script>
</body>
</html>
